"use strict";angular.module("sbAdminApp").controller("ActivityCtrl",["$scope","$http","CONFIG","i18nService",function($scope,$http,CONFIG,i18nService){$scope.columns=[{field:"first_name",displayName:"Prenom",minWidth:114},{field:"family_name",displayName:"Nom",minWidth:90}],$scope.tableOptions={columnDefs:$scope.columns,onRegisterApi:function(gridApi){$scope.gridApi=gridApi,$scope.gridApi.grid.registerRowsProcessor($scope.singleFilter,200)},enableFiltering:!1,enableCellEditOnFocus:!1,enablePaginationControls:!0,enableSorting:!0,enableRowSelection:!0,enableRowHeaderSelection:!1,enableColumnResizing:!0},i18nService.setCurrentLang("fr"),$scope.filter=function(){console.info("Filter button has been clicked"),$scope.gridApi.grid.refresh()},$scope.searchFunct=function(keyEvent){13===keyEvent.which&&$scope.filter()},$scope.singleFilter=function(renderableRows){var matcher=new RegExp($scope.filterValue);return renderableRows.forEach(function(row){var match=!1;["first_name","family_name"].forEach(function(field){row.entity[field].match(matcher)&&(match=!0)}),match||(row.visible=!1)}),renderableRows},$http({method:"GET",url:CONFIG.baseUrl+"/api/dashboard/getdata",params:{module_id:8,task:"activity"}}).then(function(response){$scope.tableError=!1;var i,nbInactif=0,nbUsers=response.data.data.length;for(i=0;nbUsers>i;i++)0==response.data.data[i].active&&($scope.tableOptions.data[i]={first_name:response.data.data[i].first_name,family_name:response.data.data[i].family_name},nbInactif+=1);$scope.percentActive=Math.round(100*(nbInactif/nbUsers))},function(response){angular.isObject(response.data)&&response.data.text?$scope.tableError=response.data.text:$scope.tableError="An unknown error occurred."})}]);
"use strict";angular.module("sbAdminApp").controller("TripsCtrl",["$scope","$http","CONFIG","i18nService",function($scope,$http,CONFIG,i18nService){$scope.columns=[{field:"userId",displayName:"Utilisateur",minWidth:114,type:"number"},{field:"tripDate",displayName:"Date",minWidth:90,type:"date"},{field:"carType",displayName:"Type véhicule",minWidth:138},{field:"distance",displayName:"Distance (km)",minWidth:137,type:"number"},{field:"consumption",displayName:"Consommation (L)",minWidth:170,type:"number"},{field:"duration",displayName:"Durée (min)",minWidth:123,type:"number"},{field:"avgConsumption",displayName:"Conso moyenne (L/100km)",minWidth:226,type:"number"},{field:"emission",displayName:"CO2 émis (kg)",minWidth:139,type:"number"},{field:"note",displayName:"Note efficacité *",minWidth:157,type:"number"}],$scope.tableOptions={columnDefs:$scope.columns,onRegisterApi:function(gridApi){$scope.gridApi=gridApi,$scope.gridApi.grid.registerRowsProcessor($scope.singleFilter,200)},enableFiltering:!1,enableCellEditOnFocus:!1,enablePaginationControls:!0,enableSorting:!0,enableRowSelection:!0,enableRowHeaderSelection:!1,enableColumnResizing:!0},i18nService.setCurrentLang("fr"),$scope.filter=function(){console.info("Filter button has been clicked"),$scope.gridApi.grid.refresh()},$scope.searchFunct=function(keyEvent){13===keyEvent.which&&$scope.filter()},$scope.singleFilter=function(renderableRows){var matcher=new RegExp($scope.filterValue);return renderableRows.forEach(function(row){var match=!1;["carType","userId","tripDate"].forEach(function(field){row.entity[field].match(matcher)&&(match=!0)}),match||(row.visible=!1)}),renderableRows},$scope.$watch(function(){return"1"===$(".ui-grid-sort-priority-number").text()},function(single){var priority=$(".ui-grid-sort-priority-number");single?priority.hide():priority.show()}),$http({method:"GET",url:CONFIG.baseUrl+"/api/dashboard/getdata",params:{module_id:1}}).then(function(response){$scope.tableOptions.data=response.data.data,$scope.tableError=!1},function(response){angular.isObject(response.data)&&response.data.text?$scope.tableError=response.data.text:$scope.tableError="An unknown error occurred."})}]);